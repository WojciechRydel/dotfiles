#!/usr/bin/bash
DIR=/tmp/screenlock

if [ ! -d "${DIR}"  ]; then
  mkdir -p "${DIR}"
fi

OUTPUTS=$(swaymsg -t get_outputs -p | awk '/Output/ { print $2 }')

for output in "${OUTPUTS[@]}"
do
  grim -o "${output}" "${DIR}/${output}.jpg"
  convert "${DIR}/${output}.jpg" -blur 0x5 "${DIR}/${output}.jpg"
done

LOCKS=$(awk -v DIR=${DIR} '{ print "-i "$0 ":" DIR "/" $0 ".jpg " }' <<< "${OUTPUTS[@]}")

swaylock $( IFS=$'\n'; echo "${LOCKS[*]}")
