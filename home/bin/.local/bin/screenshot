#!/bin/bash
DESTINATION="${1:-"dir"}"
TMP_FILE=/tmp/screenshot
FILE_FORMAT=png

getScreenshotFilePath() {
  FILE_NAME=$(date "+%Y-%m-%dT%H:%M:%S.%N")
  DIR="${HOME}/screenshots"

  mkdir -p $DIR

  FILE_PATH="${DIR}/${FILE_NAME}.${FILE_FORMAT}"

  echo $FILE_PATH
}

case "${DESTINATION}" in
  dir)
    DIR="${HOME}/screenshots"
    FILE_PATH=$(getScreenshotFilePath)

    area="$(slurp)"

    if [ -z "${area}" ]; then
      notify-send -t 300 "Screenshot aborted"
      exit
    fi

    grim -g "${area}" "${FILE_PATH}"

    notify-send "Screenshot saved" "${FILE_PATH}"
    ;;
  clipboard)
    area="$(slurp)"

    if [ -z "${area}" ]; then
      notify-send -t 300 "Screenshot aborted"
      exit
    fi

    grim -g "${area}" - | wl-copy

    notify-send "Screenshot saved" "Clipboard"
    ;;
esac
